/*
Navicat MySQL Data Transfer

Source Server         : test
Source Server Version : 50505
Source Host           : localhost:3306
Source Database       : spider

Target Server Type    : MYSQL
Target Server Version : 50505
File Encoding         : 65001

Date: 2019-11-12 20:46:39
*/

SET FOREIGN_KEY_CHECKS=0;

-- ----------------------------
-- Table structure for `apps`
-- ----------------------------
DROP TABLE IF EXISTS `apps`;
CREATE TABLE `apps` (
  `id` int(255) NOT NULL AUTO_INCREMENT,
  `appName` longtext NOT NULL,
  `ruleConfig` longtext NOT NULL,
  `localId` longtext NOT NULL,
  `type` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=10 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of apps
-- ----------------------------
INSERT INTO `apps` VALUES ('8', 'house365应用', '{\"config\":{\"chromePath\":\"C:\\\\Program Files (x86)\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\",\"params\":[{\"name\":\"title\",\"param\":\".detailHead > .detailHead__title.fl.clearfix > p\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"\"},{\"name\":\"phone\",\"param\":\".infoDetail.fr > div.adviser > div.clearfix.btnBar > div\",\"attr\":\"telno\",\"value\":\"\",\"dbParam\":\"\"},{\"name\":\"name\",\"param\":\".infoDetail.fr > div.adviser > div.clearfix.adviserPs > div.fl > div > div.adviserName.fl\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"\"},{\"name\":\"price\",\"param\":\".infoDetail.fr > div.infoDetail__title\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"\"},{\"name\":\"size\",\"param\":\".infoDetail.fr > .infoDetail__content > div:nth-child(2) > div:nth-child(1)\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"\"},{\"name\":\"decoration\",\"param\":\".infoDetail.fr > div.infoDetail__content > div:nth-child(1) > div:nth-child(2)\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"\"},{\"name\":\"floor\",\"param\":\".infoDetail.fr > div.infoDetail__content > div:nth-child(2) > div:nth-child(2)\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"\"},{\"name\":\"location\",\"param\":\".infoDetail.fr > div.infoDetail__content > div:nth-child(6) > div\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"\"},{\"name\":\"community\",\"param\":\".infoDetail.fr > div.infoDetail__content > div:nth-child(5) > div > a.infoDetail__item__local.line1\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"\"},{\"name\":\"time\",\"param\":\".infoDetail.fr > div.infoDetail__content > div:nth-child(7) > div\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"\"},{\"name\":\"propertyCosts\",\"param\":\".infoDetail.fr > div.infoDetail__content > div:nth-child(3) > div:nth-child(2)\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"\"},{\"name\":\"description\",\"param\":\".detail__mainCotetn.clearfix > div.detail__mainCotetnL.fl > div.detail__mainCotetn__intro\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"\"}],\"mainUrl\":\"http://hf.rent.house365.com/district/dl_p[分页位置].html\",\"page\":10,\"linkRule\":\"#JS_listPag > dd > div.info > h3 > a\"},\"contentUrls\":[\"http://hf.rent.house365.com/r_1259054.html\",\"http://hf.rent.house365.com/r_1259055.html\",\"http://hf.rent.house365.com/r_1259157.html\",\"http://hf.rent.house365.com/r_1259189.html\",\"http://hf.rent.house365.com/r_1259267.html\",\"http://hf.rent.house365.com/r_1259303.html\",\"http://hf.rent.house365.com/r_1259304.html\",\"http://hf.rent.house365.com/r_1259305.html\",\"http://hf.rent.house365.com/r_1259314.html\",\"http://hf.rent.house365.com/r_1259315.html\",\"http://hf.rent.house365.com/r_1259463.html\",\"http://hf.rent.house365.com/r_1259476.html\",\"http://hf.rent.house365.com/r_1256958.html\",\"http://hf.rent.house365.com/r_1259218.html\",\"http://hf.rent.house365.com/r_1259284.html\",\"http://hf.rent.house365.com/r_1259475.html\",\"http://hf.rent.house365.com/r_1259474.html\",\"http://hf.rent.house365.com/r_1155742.html\",\"http://hf.rent.house365.com/r_1052474.html\",\"http://hf.rent.house365.com/r_970407.html\",\"http://hf.rent.house365.com/r_1259366.html\",\"http://hf.rent.house365.com/r_1259473.html\",\"http://hf.rent.house365.com/r_1259255.html\",\"http://hf.rent.house365.com/r_1259400.html\",\"http://hf.rent.house365.com/r_1259283.html\",\"http://hf.rent.house365.com/r_1256556.html\",\"http://hf.rent.house365.com/r_1258549.html\",\"http://hf.rent.house365.com/r_1233034.html\",\"http://hf.rent.house365.com/r_1233037.html\",\"http://hf.rent.house365.com/r_1233032.html\",\"http://hf.rent.house365.com/r_1259472.html\",\"http://hf.rent.house365.com/r_996646.html\",\"http://hf.rent.house365.com/r_1252140.html\",\"http://hf.rent.house365.com/r_878871.html\",\"http://hf.rent.house365.com/r_1252273.html\",\"http://hf.rent.house365.com/r_1259146.html\",\"http://hf.rent.house365.com/r_1004963.html\",\"http://hf.rent.house365.com/r_1259163.html\",\"http://hf.rent.house365.com/r_1259462.html\",\"http://hf.rent.house365.com/r_1257710.html\",\"http://hf.rent.house365.com/r_1255488.html\",\"http://hf.rent.house365.com/r_1259435.html\",\"http://hf.rent.house365.com/r_1231006.html\",\"http://hf.rent.house365.com/r_1258056.html\",\"http://hf.rent.house365.com/r_1251250.html\",\"http://hf.rent.house365.com/r_1251249.html\",\"http://hf.rent.house365.com/r_1251248.html\",\"http://hf.rent.house365.com/r_1251247.html\",\"http://hf.rent.house365.com/r_1251424.html\",\"http://hf.rent.house365.com/r_1251270.html\"],\"publishConfig\":[{\"name\":\"d6e70674-8eaa-49a2-96fb-e23bda084d38\",\"host\":\"127.0.0.1\",\"port\":3306,\"user\":\"root\",\"password\":\"\",\"database\":\"test\",\"table\":\"test\",\"params\":[{\"name\":\"title\",\"param\":\".detailHead > .detailHead__title.fl.clearfix > p\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"title\"},{\"name\":\"phone\",\"param\":\".infoDetail.fr > div.adviser > div.clearfix.btnBar > div\",\"attr\":\"telno\",\"value\":\"\",\"dbParam\":\"phone\"},{\"name\":\"name\",\"param\":\".infoDetail.fr > div.adviser > div.clearfix.adviserPs > div.fl > div > div.adviserName.fl\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"name\"},{\"name\":\"price\",\"param\":\".infoDetail.fr > div.infoDetail__title\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"price\"},{\"name\":\"size\",\"param\":\".infoDetail.fr > .infoDetail__content > div:nth-child(2) > div:nth-child(1)\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"size\"},{\"name\":\"decoration\",\"param\":\".infoDetail.fr > div.infoDetail__content > div:nth-child(1) > div:nth-child(2)\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"decoration\"},{\"name\":\"floor\",\"param\":\".infoDetail.fr > div.infoDetail__content > div:nth-child(2) > div:nth-child(2)\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"floor\"},{\"name\":\"location\",\"param\":\".infoDetail.fr > div.infoDetail__content > div:nth-child(6) > div\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"location\"},{\"name\":\"community\",\"param\":\".infoDetail.fr > div.infoDetail__content > div:nth-child(5) > div > a.infoDetail__item__local.line1\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"community\"},{\"name\":\"time\",\"param\":\".infoDetail.fr > div.infoDetail__content > div:nth-child(7) > div\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"time\"},{\"name\":\"propertyCosts\",\"param\":\".infoDetail.fr > div.infoDetail__content > div:nth-child(3) > div:nth-child(2)\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"propertyCosts\"},{\"name\":\"description\",\"param\":\".detail__mainCotetn.clearfix > div.detail__mainCotetnL.fl > div.detail__mainCotetn__intro\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"description\"}],\"fail\":0,\"success\":20,\"id\":\"9005e9c0-be30-463f-a453-5203b04352b4\"},{\"name\":\"4测试编辑发布\",\"host\":\"127.0.0.1\",\"port\":3306,\"user\":\"root\",\"password\":\"\",\"database\":\"test\",\"table\":\"test\",\"params\":[{\"name\":\"title\",\"param\":\".detailHead > .detailHead__title.fl.clearfix > p\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"title\"},{\"name\":\"phone\",\"param\":\".infoDetail.fr > div.adviser > div.clearfix.btnBar > div\",\"attr\":\"telno\",\"value\":\"\",\"dbParam\":\"phone\"},{\"name\":\"name\",\"param\":\".infoDetail.fr > div.adviser > div.clearfix.adviserPs > div.fl > div > div.adviserName.fl\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"name\"},{\"name\":\"price\",\"param\":\".infoDetail.fr > div.infoDetail__title\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"price\"},{\"name\":\"size\",\"param\":\".infoDetail.fr > .infoDetail__content > div:nth-child(2) > div:nth-child(1)\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"size\"},{\"name\":\"decoration\",\"param\":\".infoDetail.fr > div.infoDetail__content > div:nth-child(1) > div:nth-child(2)\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"decoration\"},{\"name\":\"floor\",\"param\":\".infoDetail.fr > div.infoDetail__content > div:nth-child(2) > div:nth-child(2)\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"floor\"},{\"name\":\"location\",\"param\":\".infoDetail.fr > div.infoDetail__content > div:nth-child(6) > div\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"location\"},{\"name\":\"community\",\"param\":\".infoDetail.fr > div.infoDetail__content > div:nth-child(5) > div > a.infoDetail__item__local.line1\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"community\"},{\"name\":\"time\",\"param\":\".infoDetail.fr > div.infoDetail__content > div:nth-child(7) > div\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"time\"},{\"name\":\"propertyCosts\",\"param\":\".infoDetail.fr > div.infoDetail__content > div:nth-child(3) > div:nth-child(2)\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"propertyCosts\"},{\"name\":\"description\",\"param\":\".detail__mainCotetn.clearfix > div.detail__mainCotetnL.fl > div.detail__mainCotetn__intro\",\"attr\":\"\",\"value\":\"\",\"dbParam\":\"description\"}],\"fail\":0,\"success\":0,\"id\":\"ad6f3ccf-f04d-4cb5-affc-ceda9ee40e76\"}]}', 'db017f03-1806-4ec6-97fe-2c2e28981575', 'rule');
INSERT INTO `apps` VALUES ('9', '测试代码应用', 'const cheerio = require(\'cheerio\')\r\nconst tableParser = require(\'cheerio-tableparser\')\r\nconst rp = require(\'request-promise\')\r\n\r\n/**\r\n * 获取数据\r\n */\r\nasync function getData () {\r\n  const listUrl = \'http://hq.zgw.com/hefei/jiancai.html\'\r\n  const body = await rp({ uri: listUrl })\r\n  const $ = cheerio.load(body)\r\n  // 从列表获取内容页链接放入数组\r\n  let list = $(\'body > div.wrap > div.cslm_tit > div.hq_con > div.fl.lm_left > div.lm_list > ul:nth-child(2) li\')\r\n  const listArr = []\r\n  list.each((index, item) => {\r\n    listArr.push(\'http://hq.zgw.com\' + $(item).children(\'a\').attr(\'href\'))\r\n  })\r\n  console.time(\'timer\')\r\n  Promise.all(listArr.map(v => {\r\n    return getPrice(v).then(res => {\r\n      return {\r\n        link: v,\r\n        data: JSON.stringify(res)\r\n      }\r\n    })\r\n  })).then(res => {\r\n    console.log(res)\r\n    console.timeEnd(\'timer\')\r\n  })\r\n}\r\n\r\ngetData()\r\n\r\n/**\r\n * 获取价格\r\n * @param {string} url 价格页链接\r\n */\r\nasync function getPrice (url) {\r\n  const tableSelector = \'body > div.wrap > div.cslm_tit > div.hq_con > div.fl.lm_left > div > div.lm_m > div.lm_mt > div.article > table\'\r\n  const body = await rp({ uri: url })\r\n  const $ = cheerio.load(body)\r\n  const priceCol = spiderTable(tableSelector, $, false)[4]\r\n  priceCol.shift()\r\n  const pricesFormat = priceCol.map(v => $(v).data().type)\r\n  const otherData = spiderTable(tableSelector, $, true)\r\n  const nameCol = otherData[0]\r\n  const sizeCol = otherData[1]\r\n  nameCol.shift()\r\n  sizeCol.shift()\r\n  const ironArr = []\r\n  for (let i = 0, len = nameCol.length; i < len; i++) {\r\n    ironArr.push({\r\n      name: nameCol[i],\r\n      size: sizeCol[i],\r\n      price: pricesFormat[i]\r\n    })\r\n  }\r\n  return ironArr\r\n}\r\n\r\n/**\r\n * 解析表格数据\r\n * @param {string} tableSelector 表格选择器\r\n * @param {function} $ cheerio\r\n * @param {boolean} noHtml 是否需要清除html标签\r\n */\r\nfunction spiderTable (tableSelector, $, noHtml) {\r\n  tableParser($)\r\n  return $(tableSelector).parsetable(false, false, noHtml)\r\n}', '3c0fb5b1-9be8-47e6-9e8a-dd5be5e044a9', 'code');
