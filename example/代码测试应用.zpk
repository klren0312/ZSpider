{"ruleConfig":"const cheerio = require('cheerio')\r\nconst tableParser = require('cheerio-tableparser')\r\nconst rp = require('request-promise')\r\n\r\n/**\r\n * 获取数据\r\n */\r\nasync function getData () {\r\n  const listUrl = 'http://hq.zgw.com/hefei/jiancai.html'\r\n  const body = await rp({ uri: listUrl })\r\n  const $ = cheerio.load(body)\r\n  // 从列表获取内容页链接放入数组\r\n  let list = $('body > div.wrap > div.cslm_tit > div.hq_con > div.fl.lm_left > div.lm_list > ul:nth-child(2) li')\r\n  const listArr = []\r\n  list.each((index, item) => {\r\n    listArr.push('http://hq.zgw.com' + $(item).children('a').attr('href'))\r\n  })\r\n  console.time('timer')\r\n  Promise.all(listArr.map(v => {\r\n    return getPrice(v).then(res => {\r\n      return {\r\n        link: v,\r\n        data: JSON.stringify(res)\r\n      }\r\n    })\r\n  })).then(res => {\r\n    console.log(res)\r\n    console.timeEnd('timer')\r\n  })\r\n}\r\n\r\ngetData()\r\n\r\n/**\r\n * 获取价格\r\n * @param {string} url 价格页链接\r\n */\r\nasync function getPrice (url) {\r\n  const tableSelector = 'body > div.wrap > div.cslm_tit > div.hq_con > div.fl.lm_left > div > div.lm_m > div.lm_mt > div.article > table'\r\n  const body = await rp({ uri: url })\r\n  const $ = cheerio.load(body)\r\n  const priceCol = spiderTable(tableSelector, $, false)[4]\r\n  priceCol.shift()\r\n  const pricesFormat = priceCol.map(v => $(v).data().type)\r\n  const otherData = spiderTable(tableSelector, $, true)\r\n  const nameCol = otherData[0]\r\n  const sizeCol = otherData[1]\r\n  nameCol.shift()\r\n  sizeCol.shift()\r\n  const ironArr = []\r\n  for (let i = 0, len = nameCol.length; i < len; i++) {\r\n    ironArr.push({\r\n      name: nameCol[i],\r\n      size: sizeCol[i],\r\n      price: pricesFormat[i]\r\n    })\r\n  }\r\n  return ironArr\r\n}\r\n\r\n/**\r\n * 解析表格数据\r\n * @param {string} tableSelector 表格选择器\r\n * @param {function} $ cheerio\r\n * @param {boolean} noHtml 是否需要清除html标签\r\n */\r\nfunction spiderTable (tableSelector, $, noHtml) {\r\n  tableParser($)\r\n  return $(tableSelector).parsetable(false, false, noHtml)\r\n}","type":"code"}